# üììMemory Layoutüìì

<details>
<summary><b>üìñ1. Memory Layout</b></summary>
 
- **RAM** c√≥ 5 v√πng nh·ªõ:<br>
&nbsp;&nbsp;+ Text segment (Code segment). <br>
&nbsp;&nbsp;+ Data segment (Initialized Data). <br>
&nbsp;&nbsp;+ Bss segment (Uninitialized Data). <br>
&nbsp;&nbsp;+ Stack. <br>
&nbsp;&nbsp;+ Heap .
- Ban ƒë·∫ßu khai b√°o bi·∫øn s·∫Ω ƒë∆∞·ª£c l∆∞u nh∆∞ n√†o th√¨ sau n√≥ v·∫´n ƒëc l∆∞u nh∆∞ th·∫ø kh√¥ng thay ƒë·ªïi.<br>

  |**C√°c v√πng nh·ªõ**|**L∆∞u tr·ªØ**|**Quy·ªÅn truy c·∫≠p**|
  |:------------------------:|------------------------|------------------------|
  |**Text segment (Code segment)**|&nbsp;+ C√°c m√£ m√°y (m√£ m√°y: c√°c c√¢u l·ªánh th·ª±c thi trong ch∆∞∆°ng tr√¨nh).<br>&nbsp;+ Compiler Clang (macOS) l∆∞u tr·ªØ bi·∫øn h·∫±ng s·ªë to√†n c·ª•c **(const)** v√† chu·ªói h·∫±ng **(string literal)**.<br>|&nbsp;+ Ch·ªâ c√≥ quy·ªÅn ƒë·ªçc v√† th·ª±c thi, nh∆∞ng kh√¥ng c√≥ quy·ªÅn ghi.<br>&nbsp;+ Bi·∫øn h·∫±ng s·ªë to√†n c·ª•c **(const)** v√† chu·ªói h·∫±ng **(string literal)** ch·ªâ ƒë·ªçc.|
  |**Data segment (Initialized Data- D·ªØ li·ªáu kh·ªüi t·∫°o)**|&nbsp;+ C√°c bi·∫øn to√†n c·ª•c ƒë∆∞·ª£c kh·ªüi t·∫°o v·ªõi gi√° tr·ªã kh√°c 0.<br>&nbsp;+ L∆∞u tr·ªØ c√° bi·∫øn static (global + local) ƒë∆∞·ª£c kh·ªüi t·∫°o v·ªõi gi√° tr·ªã kh√°c 0.<br>&nbsp;+ V·ªõi Compiler GCC/G++ (Windows) l∆∞u tr·ªØ bi·∫øn h·∫±ng s·ªë to√†n c·ª•c **(const)** v√† chu·ªói h·∫±ng **(string literal)**.|&nbsp;+ C√≥ th·ªÉ ƒë·ªçc, ghi v√† thay ƒë·ªïi gi√° tr·ªã bi·∫øn.<br>&nbsp;+ T·∫•t c·∫£ c√°c bi·∫øn ƒë∆∞·ª£c c·∫•p ph√°t s·∫Ω b·ªã thu h·ªìi khi ch∆∞∆°ng tr√¨nh k·∫øt th√∫c.<br>&nbsp;+ Bi·∫øn h·∫±ng s·ªë to√†n c·ª•c **(const)** v√† chu·ªói h·∫±ng **(string literal)** ch·ªâ ƒë·ªçc.|
  |**Bss segment (Uninitialized Data- D·ªØ li·ªáu kh√¥ng kh·ªüi t·∫°o)**|&nbsp;+ C√°c bi·∫øn to√†n c·ª•c kh·ªüi t·∫°o v·ªõi **gi√° tr·ªã b·∫±ng 0** ho·∫∑c **kh√¥ng g·∫Øn gi√° tr·ªã**. <br>&nbsp;+ L∆∞u tr·ªØ c√° bi·∫øn static v·ªõi **gi√° tr·ªã b·∫±ng 0** ho·∫∑c **kh√¥ng g·∫Øn gi√° tr·ªã**. <br>|&nbsp;+ C√≥ th·ªÉ ƒë·ªçc, ghi v√† thay ƒë·ªïi gi√° tr·ªã bi·∫øn.<br>&nbsp;+ T·∫•t c·∫£ c√°c bi·∫øn ƒë∆∞·ª£c c·∫•p ph√°t s·∫Ω b·ªã thu h·ªìi khi ch∆∞∆°ng tr√¨nh k·∫øt th√∫c.|
  |**Stack**|&nbsp;+ C√°c bi·∫øn c·ª•c b·ªô (tr·ª´ static c·ª•c b·ªô), tham s·ªë truy·ªÅn v√†o. <br>&nbsp;+ H·∫±ng s·ªë c·ª•c b·ªô, c√≥ th·ªÉ thay ƒë·ªïi th√¥ng qua con tr·ªè. <br>|&nbsp;+ C√≥ th·ªÉ ƒë·ªçc, ghi v√† thay ƒë·ªïi gi√° tr·ªã bi·∫øn.<br>&nbsp;+ T·∫•t c·∫£ c√°c bi·∫øn ƒë∆∞·ª£c c·∫•p ph√°t s·∫Ω b·ªã thu h·ªìi khi ch∆∞∆°ng tr√¨nh k·∫øt th√∫c.|

- V√≠ d·ª•:<br>

&nbsp; + **Data segment (Initialized Data- D·ªØ li·ªáu kh·ªüi t·∫°o)**
```c
int a = 1; // l∆∞u trong Data segment
static int var = 5 // l∆∞u trong Data segment
int *ptr = &a; // l∆∞u trong Data segment

const int b = 10; // l∆∞u trong Data segment - read only
char *ptr1 = "hello"; // ptr1: l∆∞u trong Data segment - "hello" - l√† chu·ªói h·∫±ng n√™n l∆∞u trong v√πng read only ( chu·ªói h·∫±ng kh√¥ng quan t√¢m gi√° tr·ªã kh·ªüi t·∫°o l∆∞u h·∫øt v√†o data ho·∫∑c text t√πy tr√¨nh bi√™n d·ªãch)
int main()
{
  ...
}
```
&nbsp; + **Bss segment (Uninitialized Data- D·ªØ li·ªáu kh√¥ng kh·ªüi t·∫°o)**
```c
int a; // l∆∞u trong bss segment
static int var = 0 // l∆∞u trong bss segment
int *ptr = NULL; // l∆∞u trong bss segment
const int b = 0; // l∆∞u trong data segment ( h·∫±ng s·ªë to√†n c·ª•c kh√¥ng quan t√¢m gi√° tr·ªã kh·ªüi t·∫°o l∆∞u h·∫øt v√†o data ho·∫∑c text t√πy tr√¨nh bi√™n d·ªãch) - read only
char *ptr1 = "hello"; // l∆∞u trong Data segment - read only

typedef struct
{
  int x;  // v√πng ƒë·ªãa ch·ªâ x v√† y ph·ª• thu·ªôc v√†o c√°ch m√¨nh khai b√°o bi·∫øn 
  int y;
} Data;
static Data p1 = {0, 0}; // khai b√°o bi·∫øn static v√† p1 khai b√°o b·∫±ng 0 --> x,y,p1 c√πng n·∫±m ph√¢n v√πng bss
Data p2; // khai b√°o ko g·∫Øn gi√° tr·ªã --> x,y,p1 c√πng n·∫±m ph√¢n v√πng bss
Data p3 = {0, 1};  // p3 kh∆°i t·∫°o kh√°c 0 --> x, y, p3 n·∫±m ·ªü ph·∫ßn v√πng data m·∫∑c d√π x = 0 nh∆∞ng n√≥ theo ph√¢n v√πng p3

int main() 
{
  ...
}
```
&nbsp; + **Stack**
```c
// V√¨ khi vi·∫øt char ptr1[] = "hello"; tr√¨nh bi√™n d·ªãch s·∫Ω sao ch√©p n·ªôi dung chu·ªói literal n√†y v√†o ph√¢n v√πng c√≥ th·ªÉ ƒë·ªçc v√† ghi ƒë∆∞·ª£c
char ptr1[] = "hello"; // ptr1 l√† t√™n m·∫£ng ko ph·∫£i bi·∫øn n√≥ kh·ªìng n·∫±m trong ph√¢n v√πng n√†o n√≥ ph·ª• thu·ªôc v√†o ph√¢n t·ª≠ ƒë·∫ßu c√≤n "hello" ƒë∆∞·ª£c l∆∞u trong ph√¢n v√πng c√≥ th·ªÉ ƒë·ªçc v√† ghi ƒë∆∞·ª£c

// V√¨ con tr·ªè n√†y ch·ªâ tr·ªè th·∫≥ng v√†o bi·∫øn n√†y
char *ptr = "hello";// ptr1 l√† bi·∫øn con tr·ªè n√≥ n·∫±m trong ph√¢n v√πng data c√≤n "hello" l∆∞u trong v√πng read only

void swap(int *a, int *b) // c√°c bi·∫øn a,b l∆∞u trong Stack
{
 //&a = 0x01 n√≥ s·∫Ω b·ªã thu h·ªìi ƒë·ªãa ch·ªâ khi ra kh·ªèi h√†m
  //&b = 0x0a n√≥ s·∫Ω b·ªã thu h·ªìi ƒë·ªãa ch·ªâ khi ra kh·ªèi h√†m
  const int c = 10; //const local
  ptr = &c;
*ptr = 100;
printf("%d\n", c);
}

int main() 
{
 swap(10,20);
 return 0;
}
```
</details>
 
--------------------------------------------------------------------------------------------------------------------------------------------------------

<details>
<summary><b>üìñ2. V√πng nh·ªõ Heap</b></summary>

### 2.1. ƒê·∫∑c ƒëi·ªÉm
- D√πng ƒë·ªÉ c·∫•p ph√°t b·ªô nh·ªõ ƒë·ªông trong qu√° tr√¨nh th·ª±c thi ch∆∞∆°ng tr√¨nh gi√∫p v√πng nh·ªõ c·∫•p ph√°t ra ƒë∆∞·ª£c linh ƒë·ªông thay ƒë·ªïi theo ƒë·∫ßu v√†o
- Cho ph√©p ch∆∞∆°ng tr√¨nh t·∫°o ra v√† gi·∫£i ph√≥ng b·ªô nh·ªõ theo nhu c·∫ßu c·ªßa d·ªØ li·ªáu trong qu√° tr√¨nh ch·∫°y.
- C√°c h√†m nh∆∞ malloc(), calloc(), realloc() ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ c·∫•p ph√°t v√† v√† free() ƒë·ªÉ gi·∫£i ph√≥ng b·ªô nh·ªõ tr√™n heap v√† ƒë∆∞·ª£c l∆∞u trong th∆∞ vi·ªán **stdlib**
- ƒê·ªá nguy√™n: G·ªçi lai ch√≠nh b·∫£n th√¢n n√≥ v√† kh√¥ng k·∫øt th√∫c ƒë∆∞·ª£c h√†m
### 2.2. C√°c h√†m c·∫•p ph√°t v√† gi·∫£i ph√≥ng v√πng nh·ªõ

 |**C√°c ki·ªÉu c·∫•p ph√°t**|**ƒê·∫∑c ƒëi·ªÉm**|**c√∫ ph√°p**|
 |:------------------------:|-------------------|------------------------|
 |**malloc**<br>**calloc**|&nbsp;+ C·∫•p ph√°t b·ªô nh·ªõ v·ªõi k√≠ch th∆∞·ªõc ƒë∆∞·ª£c ch·ªâ ƒë·ªãnh tr∆∞·ªõc.<br>&nbsp;+ K√≠ch th∆∞·ªõc:<br>&nbsp;&nbsp;* Ph·ª• thu·ªôc v√†o s·ªë l∆∞·ª£ng x k√≠ch th∆∞·ªõc t·ª´ng ph·∫ßn t·ª≠.<br>&nbsp;&nbsp;* Ph·ª• thu·ªôc v√†o √©p ki·ªÉu<br>&nbsp;+ Sau khi c·∫•p ph√°t c·∫ßn ki·ªÉm tra xem c·∫•p ph√°t th√†nh c√¥ng ch∆∞a|&nbsp;+ void *malloc(size_t size)<br>&nbsp;+ void *calloc(size_t num, size_t size)|
 |**realloc**|Thay ƒë·ªïi k√≠ch th∆∞·ªõc v√πng nh·ªõ ƒë√£ ƒë∆∞·ª£c c·∫•p ph√°t|void *realloc(void *_Memory. size_t _NewSize)|
 |**free**|Thu h·ªìi v√πng nh·ªõ c·∫•p ph√°t khi kh√¥ng d√πng n·ªØa n·∫øu kh√¥ng s·∫Ω kh√¥ng c√≤n v√πng nh·ªõ c·∫•p ph√°t v√† b√°o l·ªói memoryleak|free(ptr)|

- V√≠ d·ª•:<br>

```c
#include <stdlib.h>

int main()
{
   // S·ª≠ d·ª•ng malloc 
   scanf("%d", &size);
   int *ptr = (int*)malloc(size * sizeof(int)); //ƒë·ªÉ truy su·∫•t con tr·ªè ki·ªÉu void ta √©p ki·ªÉu ƒë√∫ng ki·ªÉu c·ªßa t·ª´ng ph·∫ßn t·ª≠ ƒë·ªÉ n√≥ ƒë·ªçc ƒë√∫ng gi·ªØ li·ªáu

   // ki·ªÉm tra c√≥ c·∫•p ph√°t th√†nh c√¥ng kh√¥ng
   if(ptr == NULL)  
   {
      printf("C·∫•p ph√°t b·ªô nh·ªõ th·∫•t b·∫°i\n");
      return 1;  
   }

   // S·ª≠ d·ª•ng calloc
   arr_calloc = (int*)calloc(size, sizeof(int));

   // S·ª≠ d·ª•ng realloc
   ptr = (int*)realloc(ptr, 10*sizeof(int)); // c·∫•p ph√°t th√™m 10 ph·∫ßn t·ª≠ ki·ªÉu int n·ªØa cho con tr·ªè ptr

   // Gi·∫£i ph√≥ng b·ªô nh·ªõ
   free(ptr);
   free(arr_calloc);
   // Sau khi gi·∫£i ph√≥ng xong ph·∫£i g·∫Øn con tr·ªè = NULL
   return 0;
}
```
</details>
 
--------------------------------------------------------------------------------------------------------------------------------------------------------

<details>
<summary><b>üìñ3. Memoryleak - Overflow</b></summary>

- **C√°c l·ªói:** <br>
&nbsp;+ **overflow:** Ghi d·ªØ li·ªáu v∆∞·ª£t qu√° v√πng nh·ªõ (kh√¥ng ƒë·ªß b·ªô nh·ªõ).<br>
&nbsp;+ **memory leak:** X·∫£y ra khi m√¨nh c·∫•p ph√°t v√πng nh·ªõ m·ªõi nh∆∞ng kh√¥ng ƒë·ªß v√πng nh·ªõ c·∫•p ph√°t do v√πng nh·ªõ l√∫c tr∆∞·ªõc m√¨nh ch∆∞a thu h·ªìi n√™n .
- **Stack:** <br>
&nbsp;+ N·∫øu ch∆∞∆°ng tr√¨nh s·ª≠ d·ª•ng qu√° nhi·ªÅu b·ªô nh·ªõ v∆∞·ª£t qu√° kh·∫£ nƒÉng l∆∞u tr·ªØ c·ªßa Stack ch·∫Øc ch·∫Øn s·∫Ω x·∫£y ra t√¨nh tr·∫°ng tr√†n b·ªô nh·ªõ Stack (Stack overflow).<br>
&nbsp;+ C√°c tr∆∞·ªùng h·ª£p x·∫£y ra nh∆∞ b·∫°n kh·ªüi t·∫°o qu√° nhi·ªÅu bi·∫øn c·ª•c b·ªô, h√†m ƒë·ªá quy v√¥ h·∫°n,...
- **Heap:** <br>
&nbsp;+ N·∫øu b·∫°n li√™n t·ª•c c·∫•p ph√°t v√πng nh·ªõ m√† kh√¥ng gi·∫£i ph√≥ng th√¨ s·∫Ω b·ªã l·ªói tr√†n v√πng nh·ªõ Heap (Heap overflow).<br>
&nbsp;+ N·∫øu kh·ªüi t·∫°o m·ªôt v√πng nh·ªõ qu√° l·ªõn m√† v√πng nh·ªõ Heap kh√¥ng th·ªÉ l∆∞u tr·ªØ m·ªôt l·∫ßn ƒë∆∞·ª£c s·∫Ω b·ªã l·ªói kh·ªüi t·∫°o v√πng nh·ªõ Heap th·∫•t b·∫°i.
</details>
 
--------------------------------------------------------------------------------------------------------------------------------------------------------

<details>
<summary><b>üìñ 4. So s√°nh malloc - calloc</b></summary>

|                          |**malloc**|**calloc**|**realloc**|
|:------------------------:|------------------------|------------------------|------------------------|
|C√∫ ph√°p|void* malloc(size_t size)<br>|void *calloc(size_t num, size_t size)|void* realloc(void *_Memory, size_t _NewSize)|
|Ch·ª©c nƒÉng|&nbsp;Memory allocation: C·∫•p ph√°t m·ªôt kh·ªëi b·ªô nh·ªõ ƒë·ªông c√≥ k√≠ch th∆∞·ªõc size byte.|&nbsp;Contiguous allocation: C·∫•p ph√°t v√πng nh·ªõ ƒë·ªông g·ªìm num ph·∫ßn t·ª≠, m·ªói ph·∫ßn t·ª≠ c√≥ k√≠ch th∆∞·ªõc size byte.|&nbsp;Reallocation: Thay ƒë·ªïi k√≠ch th∆∞·ªõc c·ªßa v√πng nh·ªõ ƒë√£ ƒë∆∞·ª£c c·∫•p ph√°t tr∆∞·ªõc ƒë√≥ b·ªüi malloc() ho·∫∑c calloc().|
|Gi√° tr·ªã tr·∫£ v·ªÅ|&nbsp;+ H√†m tr·∫£ v·ªÅ con tr·ªè t·ªõi v√πng nh·ªõ n·∫øu c·∫•p ph√°t th√†nh c√¥ng v·ªõi gi√° tr·ªã r√°c.<br>&nbsp;+ Tr·∫£ v·ªÅ NUL n·∫øu c·∫•p ph√°t FAIL|&nbsp;+ H√†m tr·∫£ v·ªÅ con tr·ªè tr·ªè t·ªõi v√πng nh·ªõ ƒë∆∞·ª£c c·∫•p ph√°t v√† v√πng nh·ªõ ƒë∆∞·ª£c kh·ªüi t·∫°o gi√° tr·ªã = 0 n·∫øu c·∫•p ph√°t th√†nh c√¥ng.<br>&nbsp;+ Tr·∫£ v·ªÅ NUL n·∫øu c·∫•p ph√°t FAIL|&nbsp;+ H√†m tr·∫£ v·ªÅ con tr·ªè tr·ªè t·ªõi v√πng nh·ªõ ƒë√£ thay ƒë·ªïi k√≠ch th∆∞·ªõc n·∫øu c·∫•p ph√°t th√†nh c√¥ng v·ªõi gi√° tr·ªã r√°c v√† gi·ªØ l·∫°i gi√° tr·ªã c≈©.<br>&nbsp;+ Tr·∫£ v·ªÅ NUL n·∫øu c·∫•p ph√°t FAIL|
</details>
 
--------------------------------------------------------------------------------------------------------------------------------------------------------

<details>
<summary><b>üìñ5. So s√°nh Stack - Heap</b></summary>

|                          |**Stack**|**Heap**|
|:------------------------:|----------------------|------------------------|
|Ch·ª©c nƒÉng|L∆∞u tr·ªØ c√°c bi·∫øn c·ª•c b·ªô trong h√†m (tr·ª´ static c·ª•c b·ªô), tham s·ªë truy·ªÅn v√†o.|L∆∞u tr·ªØ v√πng nh·ªõ cho nh·ªØng bi·∫øn ƒë∆∞·ª£c c·∫•p ph√°t ƒë·ªông b·ªüi c√°c h√†m malloc - calloc - realloc|
|V·ªã tr√≠ trong RAM|Do h·ªá ƒëi·ªÅu h√†nh qu·∫£n l√Ω t·ª± ƒë·ªông.|Qu·∫£n l√Ω b·ªüi l·∫≠p tr√¨nh vi√™n|
|C√°ch c·∫•p ph√°t|&nbsp;+ C·∫•p ph√°t tr∆∞·ªõc khi ch·∫°y ch∆∞∆°ng tr√¨nh.<br>&nbsp;+ Kh√¥ng th·ªÉ c·∫•p ph√°t hay ph√¢n b·ªï l·∫°i b·ªô nh·ªõ khi ch·∫°y ch∆∞∆°ng tr√¨nh.<br>&nbsp;+ T·ª± ƒë·ªông c·∫•p ph√°t.<br>|&nbsp;+ C·∫•p ph√°t trong qu√° tr√¨nh ch·∫°y ch∆∞∆°ng tr√¨nh.<br>&nbsp;+ C√≥ th·ªÉ ƒëi·ªÅu ch·ªânh hay gi·∫£i ph√≥ng b·ªô nh·ªõ khi ch·∫°y ch∆∞∆°ng tr√¨nh.<br>&nbsp;+ Qu·∫£n l√Ω b·ªô nh·ªõ th√¥ng qu√° c√°c h√†m ```malloc```,```calloc```,```realloc```,```free```|
|C√°ch thu h·ªìi v√πng nh·ªõ|T·ª± ƒë·ªông gi·∫£i ph√≥ng khi h√†m th·ª±c hi·ªán xong c√¥ng vi·ªác c·ªßa m√¨nh.|T·ª± tay gi·∫£i ph√≥ng v√πng nh·ªõ th√¥ng qua h√†m **free()**|
|L·ªói th∆∞·ªùng g·∫∑p|Stack overflow|Memory leak|
|·ª®ng d·ª•ng|Bi·∫øn ƒë∆°n gi·∫£n, m·∫£ng nh·ªè, c·ªë ƒë·ªãnh k√≠ch th∆∞·ªõc |D·ªØ li·ªáu l·ªõn, m·∫£ng c√≥ nhi·ªÅu ph·∫ßn t·ª≠, kh√¥ng bi·∫øt tr∆∞·ªõc k√≠ch th∆∞·ªõc t·∫°i th·ªùi ƒëi·ªÉm bi√™n d·ªãch.|

 </details>

-----------------------------------------------------------------------------------------------------------------------------------------------
